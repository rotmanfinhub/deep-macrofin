
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Deep-MacroFin Wiki">
      
      
        <meta name="author" content="Rotman Finhub">
      
      
        <link rel="canonical" href="https://rotmanfinhub.github.io/deep-macrofin/usage/">
      
      
        <link rel="prev" href="../api/utils/">
      
      
        <link rel="next" href="../usage_timestep/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.44">
    
    
      
        <title>General Usage - Deep-MacroFin Wiki</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.0253249f.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
    
    
      <link rel="stylesheet" href="../assets/css/lightbox.css">
    
      <link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.4.0/css/all.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#basic-usage" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Deep-MacroFin Wiki" class="md-header__button md-logo" aria-label="Deep-MacroFin Wiki" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Deep-MacroFin Wiki
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              General Usage
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Dark Mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Dark Mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Light Mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Light Mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/rotmanfinhub/deep-macrofin" target="_blank" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
    
  
  Home Page

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../api/models/" class="md-tabs__link">
          
  
  API

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="./" class="md-tabs__link">
          
  
  Basic Usage

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../examples/odes/basic_ode1/" class="md-tabs__link">
          
  
  Basic Examples

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../examples/macrofinance_models/log_utility/" class="md-tabs__link">
          
  
  Economic Problems

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Deep-MacroFin Wiki" class="md-nav__button md-logo" aria-label="Deep-MacroFin Wiki" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Deep-MacroFin Wiki
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/rotmanfinhub/deep-macrofin" target="_blank" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home Page
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    API
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            API
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/models/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    deep_macrofin.models
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/evaluations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    deep_macrofin.evaluations
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/pde_model/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    deep_macrofin.pde_model
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/pde_model_time_step/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    deep_macrofin.pde_model_time_step
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/utils/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    deep_macrofin.utils
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Basic Usage
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Basic Usage
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    General Usage
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    General Usage
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#define-pde-system" class="md-nav__link">
    <span class="md-ellipsis">
      Define PDE System
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Define PDE System">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#training-configs" class="md-nav__link">
    <span class="md-ellipsis">
      Training Configs
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Training Configs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#optimizers" class="md-nav__link">
    <span class="md-ellipsis">
      Optimizers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#samplingmethod" class="md-nav__link">
    <span class="md-ellipsis">
      SamplingMethod
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamic-loss-weighting" class="md-nav__link">
    <span class="md-ellipsis">
      Dynamic Loss Weighting
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#latex-variable-map" class="md-nav__link">
    <span class="md-ellipsis">
      Latex Variable Map
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#define-problem-domain" class="md-nav__link">
    <span class="md-ellipsis">
      Define Problem Domain
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#define-agentendogvar" class="md-nav__link">
    <span class="md-ellipsis">
      Define Agent/EndogVar
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Define Agent/EndogVar">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#model-configs" class="md-nav__link">
    <span class="md-ellipsis">
      Model Configs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#defining-multiple-agentsendogvars" class="md-nav__link">
    <span class="md-ellipsis">
      Defining Multiple Agents/EndogVars
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#conditions-for-agentendogvar" class="md-nav__link">
    <span class="md-ellipsis">
      Conditions for Agent/EndogVar
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#add-equations-etc" class="md-nav__link">
    <span class="md-ellipsis">
      Add Equations, etc
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Add Equations, etc">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#about-labels" class="md-nav__link">
    <span class="md-ellipsis">
      About Labels
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#defining-derivatives-with-equations" class="md-nav__link">
    <span class="md-ellipsis">
      Defining Derivatives with Equations
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#training-and-evaluation" class="md-nav__link">
    <span class="md-ellipsis">
      Training and Evaluation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Training and Evaluation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#print-the-model" class="md-nav__link">
    <span class="md-ellipsis">
      Print the Model
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#plot" class="md-nav__link">
    <span class="md-ellipsis">
      Plot
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Plot">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#plot-learnable-variables" class="md-nav__link">
    <span class="md-ellipsis">
      Plot Learnable Variables
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#plot-variables-defined-by-equations" class="md-nav__link">
    <span class="md-ellipsis">
      Plot Variables Defined by Equations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#plot-loss" class="md-nav__link">
    <span class="md-ellipsis">
      Plot Loss
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../usage_timestep/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Time Stepping Scheme
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../faq/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tips and Additional Considerations
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Basic Examples
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Basic Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/odes/basic_ode1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    A simple ODE
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/odes/basic_ode2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Yet another simple ODE
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/odes/second_order/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Second-order ODE
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/odes/cauchy-euler/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cauchy-Euler Equation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/approx/discont/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Discontinuous Function Approximation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/odes/predator_prey/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Predator-Prey Model
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/pdes/laplace/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Laplace Equation Dirichlet Problem
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/pdes/heat/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Time-dependent Heat Equation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/pdes/diffusion/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Diffusion Equation
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Economic Problems
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Economic Problems
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/macrofinance_models/log_utility/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Log Utility
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/macrofinance_models/1d_problem/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1D Problem
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/macrofinance_models/pymacrofin_2d_problem/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PyMacroFin 2D Problem
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/macrofinance_models/di_tella/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Di Tella (2017)
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#define-pde-system" class="md-nav__link">
    <span class="md-ellipsis">
      Define PDE System
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Define PDE System">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#training-configs" class="md-nav__link">
    <span class="md-ellipsis">
      Training Configs
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Training Configs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#optimizers" class="md-nav__link">
    <span class="md-ellipsis">
      Optimizers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#samplingmethod" class="md-nav__link">
    <span class="md-ellipsis">
      SamplingMethod
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamic-loss-weighting" class="md-nav__link">
    <span class="md-ellipsis">
      Dynamic Loss Weighting
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#latex-variable-map" class="md-nav__link">
    <span class="md-ellipsis">
      Latex Variable Map
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#define-problem-domain" class="md-nav__link">
    <span class="md-ellipsis">
      Define Problem Domain
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#define-agentendogvar" class="md-nav__link">
    <span class="md-ellipsis">
      Define Agent/EndogVar
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Define Agent/EndogVar">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#model-configs" class="md-nav__link">
    <span class="md-ellipsis">
      Model Configs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#defining-multiple-agentsendogvars" class="md-nav__link">
    <span class="md-ellipsis">
      Defining Multiple Agents/EndogVars
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#conditions-for-agentendogvar" class="md-nav__link">
    <span class="md-ellipsis">
      Conditions for Agent/EndogVar
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#add-equations-etc" class="md-nav__link">
    <span class="md-ellipsis">
      Add Equations, etc
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Add Equations, etc">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#about-labels" class="md-nav__link">
    <span class="md-ellipsis">
      About Labels
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#defining-derivatives-with-equations" class="md-nav__link">
    <span class="md-ellipsis">
      Defining Derivatives with Equations
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#training-and-evaluation" class="md-nav__link">
    <span class="md-ellipsis">
      Training and Evaluation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Training and Evaluation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#print-the-model" class="md-nav__link">
    <span class="md-ellipsis">
      Print the Model
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#plot" class="md-nav__link">
    <span class="md-ellipsis">
      Plot
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Plot">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#plot-learnable-variables" class="md-nav__link">
    <span class="md-ellipsis">
      Plot Learnable Variables
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#plot-variables-defined-by-equations" class="md-nav__link">
    <span class="md-ellipsis">
      Plot Variables Defined by Equations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#plot-loss" class="md-nav__link">
    <span class="md-ellipsis">
      Plot Loss
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="basic-usage">Basic Usage</h1>
<p>This document shows how to configure and train a model using <code>deep_macrofin</code>.</p>
<h2 id="define-pde-system">Define PDE System</h2>
<p>Firstly, we import <code>PDEModel</code> (<a href="../api/pde_model/#pdemodel">API</a>) from the package to define the problem to be solved. The following code snippet defines a PDE model with default training settings and name <code>example</code>:</p>
<div class="language-py highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">from</span> <span class="nn">deep_macrofin</span> <span class="kn">import</span> <span class="n">PDEModel</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="n">pde_model</span> <span class="o">=</span> <span class="n">PDEModel</span><span class="p">(</span><span class="s2">&quot;model_name&quot;</span><span class="p">)</span>
</span></code></pre></div>
<p><code>PDEModel</code> takes three parameters: <code>name: str, config: Dict[str, Any] = DEFAULT_CONFIG, latex_var_mapping: Dict[str, str] = {}</code>. Only <code>name</code> is required. The trained models will be saved with filename <code>name</code> by default.</p>
<h3 id="training-configs">Training Configs</h3>
<p>The default training configs set batch size = 100, epochs = 1000, learning rate = <span class="arithmatex">\(10^{-3}\)</span>, and AdamW optimizer. In this setting, loss will be logged to a csv file every 100 epochs during training (<code>loss_log_interval</code>), and data points are sampled randomly. 
<div class="language-py highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="n">DEFAULT_CONFIG</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>    <span class="s2">&quot;batch_size&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>    <span class="s2">&quot;num_epochs&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>    <span class="s2">&quot;lr&quot;</span><span class="p">:</span> <span class="mf">1e-3</span><span class="p">,</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>    <span class="s2">&quot;loss_log_interval&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>    <span class="s2">&quot;optimizer_type&quot;</span><span class="p">:</span> <span class="n">OptimizerType</span><span class="o">.</span><span class="n">AdamW</span><span class="p">,</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>    <span class="s2">&quot;sampling_method&quot;</span><span class="p">:</span> <span class="n">SamplingMethod</span><span class="o">.</span><span class="n">UniformRandom</span><span class="p">,</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>    <span class="s2">&quot;refinement_sample_interval&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.2</span> <span class="o">*</span> <span class="n">num_epochs</span><span class="p">),</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>    <span class="s2">&quot;loss_balancing&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a>    <span class="s2">&quot;bernoulli_prob&quot;</span><span class="p">:</span> <span class="mf">0.9999</span><span class="p">,</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a>    <span class="s2">&quot;loss_balancing_temp&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a>    <span class="s2">&quot;loss_balancing_alpha&quot;</span><span class="p">:</span> <span class="mf">0.999</span><span class="p">,</span>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a>    <span class="s2">&quot;soft_adapt_interval&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a>    <span class="s2">&quot;loss_soft_attention&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a><span class="p">}</span>
</span></code></pre></div></p>
<p>This dictionary can be imported:
<div class="language-py highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="kn">from</span> <span class="nn">deep_macrofin</span> <span class="kn">import</span> <span class="n">DEFAULT_CONFIG</span>
</span></code></pre></div></p>
<p>We can override any of the settings by passing a dictionary to the <code>config</code> parameter. The dictionary does not need to be complete. Any missing values are automatically replaced with default values. The following initialization will only change the number of training epoches to 10000, and keep everything else the same as default.
<div class="language-py highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="kn">from</span> <span class="nn">deep_macrofin</span> <span class="kn">import</span> <span class="n">PDEModel</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="n">pde_model</span> <span class="o">=</span> <span class="n">PDEModel</span><span class="p">(</span><span class="s2">&quot;model_name&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;num_epochs&quot;</span><span class="p">:</span> <span class="mi">10000</span><span class="p">})</span>
</span></code></pre></div></p>
<h4 id="optimizers">Optimizers</h4>
<p>OptimizerType is a <code>Enum</code> object that can be imported from the package. Currently, we support the following optimizer types:
<div class="language-py highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="kn">from</span> <span class="nn">deep_macrofin</span> <span class="kn">import</span> <span class="n">OptimizerType</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="c1"># OptimizerType.Adam = &quot;Adam&quot;</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="c1"># OptimizerType.AdamW = &quot;AdamW&quot;</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="c1"># OptimizerType.LBFGS = &quot;LBFGS&quot;</span>
</span></code></pre></div></p>
<blockquote>
<p>Note: when KAN is used as one of the learnable variables, only LBFGS is supported.</p>
</blockquote>
<h4 id="samplingmethod">SamplingMethod</h4>
<p>SamplingMethod is a <code>Enum</code> object that can be imported from the package. Currently, we support the following sampling methods:
<div class="language-py highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="kn">from</span> <span class="nn">deep_macrofin</span> <span class="kn">import</span> <span class="n">SamplingMethod</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="c1"># SamplingMethod.UniformRandom = &quot;UniformRandom&quot;</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="c1"># SamplingMethod.FixedGrid = &quot;FixedGrid&quot;</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="c1"># SamplingMethod.ActiveLearning = &quot;ActiveLearning&quot;</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="c1"># SamplingMethod.RARG = &quot;RAR-G&quot;</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="c1"># SamplingMethod.RARD = &quot;RAR-D&quot;</span>
</span></code></pre></div></p>
<p>When sampling method is <code>ActiveLearning</code>, <code>RARG</code>, or <code>RARD</code>, additional points to help learning are sampled <code>refinement_rounds</code> times. The sampling epochs are equally spaced over the entire training period.</p>
<blockquote>
<p>Note: For FixedGrid sampling, the batch size is applied to each dimension, and the final sample is of shape <span class="arithmatex">\((B^n, n)\)</span>, where <span class="arithmatex">\(B\)</span> is batch size, <span class="arithmatex">\(n\)</span> is number of state variables. Batch size should be set to a lower value than in uniform sampling.</p>
<p>Note: RAR-G and RAR-D are implemented based on Wu et al. 2022<sup id="fnref:1"><a class="footnote-ref" href="#fn:1">1</a></sup>, the underlying sampling method for additional residual points is UniformRandom, and the base sampling method for training is FixedGrid. The total number of additional residual points sampled over the entire training period is <span class="arithmatex">\(B^n\)</span>. In each addition, <span class="arithmatex">\(\frac{B^n}{\text{refinement rounds}}\)</span> points are added.</p>
<p>Note: ActiveLearning is not yet implemented specifically, and currently uses the logic of RAR-G.</p>
</blockquote>
<h4 id="dynamic-loss-weighting">Dynamic Loss Weighting</h4>
<p><strong>Loss Balancing</strong> implements the Relative Loss Balancing with Random Lookback (ReLoBRaLo) algorithm in Bischof and Kraus 2021<sup id="fnref:2"><a class="footnote-ref" href="#fn:2">2</a></sup>. The update follows the equations:</p>
<div class="arithmatex">\[\lambda_i^{bal}(t,t') = m \frac{\exp\left( \frac{\mathcal{L}_i(t)}{\mathcal{T}\mathcal{L}_i(t')}\right)}{\sum_{j=1}^m \exp\left( \frac{\mathcal{L}_j(t)}{\mathcal{T}\mathcal{L}_j(t')}\right)}\]</div>
<div class="arithmatex">\[\lambda_i^{hist}(t)=\rho \lambda_i (t-1) + (1-\rho) \lambda_i^{bal}(t,0)\]</div>
<div class="arithmatex">\[\lambda_i(t) = \alpha \lambda_i^{hist} + (1-\alpha) \lambda_i^{bal}(t,t-1)\]</div>
<p><span class="arithmatex">\(m\)</span> is the number of loss functions. <span class="arithmatex">\(i\in \{1,...,m\}\)</span> are indices for loss functions. <span class="arithmatex">\(\mathcal{T}\)</span> (<code>loss_balancing_temp</code>) is softmax temperature. <span class="arithmatex">\(\rho\)</span> is a Bernoulli random variable with <span class="arithmatex">\(\mathbb{E}(\rho)\approx 1\)</span> (<code>bernoulli_prob</code>). <span class="arithmatex">\(\alpha\)</span> is the exponential decay rate (<code>loss_balancing_alpha</code>).</p>
<p><strong>Soft Adapt</strong> implements the algorithm in Heydari et al. 2019<sup id="fnref:3"><a class="footnote-ref" href="#fn:3">3</a></sup>. It merges the loss Weighted and normalized approach. It also uses <code>loss_balancing_temp</code> parameter as the softmax temperature.</p>
<div class="arithmatex">\[ns_i = \frac{s_i}{\sum_{j=1}^m |s_j|}\]</div>
<div class="arithmatex">\[\alpha_i = \frac{\exp(\beta(ns_i - \max(ns_i)))}{\sum_{j=1}^m \exp(\beta(ns_j - \max(ns_j)))}\]</div>
<div class="arithmatex">\[\alpha_i = \frac{f_i \alpha_i}{\sum_{j=1}^m f_j \alpha_j}\]</div>
<p><strong>Soft Attention</strong> implements the algorithm in Song et al. 2024<sup id="fnref:4"><a class="footnote-ref" href="#fn:4">4</a></sup>. Specifically, loss weights are linear neural networks applied to individual grid points in the training data.</p>
<h3 id="latex-variable-map">Latex Variable Map</h3>
<p>Economic models may involve a large amount of variables and equations. Each variable can have super-/subscripts. To properly distinguish super-/subscripts from powers/derivatives and parse equations when LaTex formula are provided, we require a mapping from LaTex variables to Python strings. The keys are LaTex strings in raw format <code>r""</code>, and the values are the corresponding python string. The following dictionary maps LaTex string <span class="arithmatex">\(\xi_t^h\)</span> to Python string <code>"xih"</code>, and LaTex string <span class="arithmatex">\(q_t^a\)</span> to Python string <code>"qa"</code>.</p>
<div class="language-py highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="n">latex_var_mapping</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>    <span class="sa">r</span><span class="s2">&quot;\xi_t^h&quot;</span><span class="p">:</span> <span class="s2">&quot;xih&quot;</span><span class="p">,</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>    <span class="sa">r</span><span class="s2">&quot;q_t^a&quot;</span><span class="p">:</span> <span class="s2">&quot;qa&quot;</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="p">}</span> <span class="c1"># define mapping</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="kn">from</span> <span class="nn">deep_macrofin</span> <span class="kn">import</span> <span class="n">PDEModel</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="n">pde_model</span> <span class="o">=</span> <span class="n">PDEModel</span><span class="p">(</span><span class="s2">&quot;model_name&quot;</span><span class="p">,</span> <span class="n">latex_var_mapping</span><span class="o">=</span><span class="n">latex_var_mapping</span><span class="p">)</span> <span class="c1"># enforce the mapping for formula parsing in the model</span>
</span></code></pre></div>
<h3 id="define-problem-domain">Define Problem Domain</h3>
<p>The problem dimension and domain are defined using state variables through <code>PDEModel.set_state</code> method (<a href="../api/pde_model/#set_state">API</a>).</p>
<p>The following defines a 1D problem, with state variable <span class="arithmatex">\(x\)</span>, domain <span class="arithmatex">\(x\in [0.01,0.99]\)</span>. 
<div class="language-py highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="n">pde_model</span><span class="o">.</span><span class="n">set_state</span><span class="p">([</span><span class="s2">&quot;x&quot;</span><span class="p">],</span> <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">]})</span>
</span></code></pre></div></p>
<p>The following defines a 2D problem, with state variable <span class="arithmatex">\((x,y)\)</span>, domain <span class="arithmatex">\((x,y)\in [-1,1]\times[-1,1]\)</span> (default domain). 
<div class="language-py highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="n">pde_model</span><span class="o">.</span><span class="n">set_state</span><span class="p">([</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">])</span>
</span></code></pre></div></p>
<p>The following defines a 2D problem, with state variable <span class="arithmatex">\((x,y)\)</span>, domain <span class="arithmatex">\((x,y)\in [0,1]\times[0,\pi]\)</span>. 
<div class="language-py highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="n">pde_model</span><span class="o">.</span><span class="n">set_state</span><span class="p">([</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">],</span> <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">]})</span> <span class="c1"># torch.pi is also acceptable (They are the same constant)</span>
</span></code></pre></div></p>
<h2 id="define-agentendogvar">Define Agent/EndogVar</h2>
<p>Agents and EndogVar (<a href="../api/models/#learnablevar">LearnableVar</a>) can only be added to a PDEModel after the states are defined, so that the functions to compute derivatives can be constructed properly.</p>
<p>To add a single agent or endogenous variable to a model with default settings, we can use <code>add_agent</code> (<a href="../api/pde_model/#add_agent">API</a>) and <code>add_endog</code> (<a href="../api/pde_model/#add_endog">API</a>):
<div class="language-py highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="n">pde_model</span><span class="o">.</span><span class="n">add_agent</span><span class="p">(</span><span class="s2">&quot;xih&quot;</span><span class="p">)</span> <span class="c1"># this adds an agent with name: xih</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="n">pde_model</span><span class="o">.</span><span class="n">add_endog</span><span class="p">(</span><span class="s2">&quot;qa&quot;</span><span class="p">)</span> <span class="c1"># this adds an agent with name: qa</span>
</span></code></pre></div>
If the latex_variable_mapping is properly setup in the <a href="#latex-variable-map">previous step</a>, <code>xih</code> is associated with <span class="arithmatex">\(\xi_t^h\)</span> and <code>qa</code> is associated with <span class="arithmatex">\(q_t^a\)</span> in formula parsing and evaluations.</p>
<p>Suppose there are two state variables <span class="arithmatex">\(x,y\)</span>, then the derivatives <code>xih_x</code> (<span class="arithmatex">\(\frac{\partial \xi_t^h}{\partial x}\)</span>), <code>xih_y</code> (<span class="arithmatex">\(\frac{\partial \xi_t^h}{\partial y}\)</span>), <code>xih_xx</code> (<span class="arithmatex">\(\frac{\partial^2 \xi_t^h}{\partial x^2}\)</span>), <code>xih_yy</code> (<span class="arithmatex">\(\frac{\partial^2 \xi_t^h}{\partial y^2}\)</span>), <code>xih_xy</code> (<span class="arithmatex">\(\frac{\partial^2 \xi_t^h}{\partial y\partial x}\)</span>), and <code>xih_yx</code> (<span class="arithmatex">\(\frac{\partial^2 \xi_t^h}{\partial x\partial y}\)</span>) are computed for <span class="arithmatex">\(\xi_t^h\)</span>. Similar for <span class="arithmatex">\(q_t^a\)</span>.</p>
<h3 id="model-configs">Model Configs</h3>
<p>The default learnable variable configs sets training device to <code>"cuda"</code> if it is available. Otherwise the models will be trained on CPU. However, we recommend using CPU for training, because the models are not usually computationally expensive, while the synchronization (evaluating string formula on CPU and transferring computation to GPU) can significantly bottleneck the computation speed of GPUs. 
The models are default to 4-layer MLPs. Each layer contains 30 hidden units, with <span class="arithmatex">\(\tanh(x)\)</span> activation. 
By default, <code>positive=False</code>, each model can output any values <span class="arithmatex">\((-\infty,\infty)\)</span>. Derivatives will be taken up to second order (<code>derivative_order=2</code>).
<div class="language-py highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="n">DEFAULT_LEARNABLE_VAR_CONFIG</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>    <span class="s2">&quot;device&quot;</span><span class="p">:</span> <span class="s2">&quot;cuda&quot;</span> <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span> <span class="k">else</span> <span class="s2">&quot;cpu&quot;</span><span class="p">,</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>    <span class="s2">&quot;hidden_units&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">30</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">30</span><span class="p">],</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>    <span class="s2">&quot;layer_type&quot;</span><span class="p">:</span> <span class="n">LayerType</span><span class="o">.</span><span class="n">MLP</span><span class="p">,</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>    <span class="s2">&quot;activation_type&quot;</span><span class="p">:</span> <span class="n">ActivationType</span><span class="o">.</span><span class="n">Tanh</span><span class="p">,</span>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a>    <span class="s2">&quot;positive&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a>    <span class="s2">&quot;derivative_order&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a><span class="p">}</span>
</span></code></pre></div></p>
<p>This dictionary can be imported:
<div class="language-py highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="kn">from</span> <span class="nn">deep_macrofin</span> <span class="kn">import</span> <span class="n">DEFAULT_LEARNABLE_VAR_CONFIG</span>
</span></code></pre></div></p>
<p>LayerType and ActivationType are <code>Enum</code> objects that can be imported from the package. Currently, we support the following layers and activation types:
<div class="language-py highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="kn">from</span> <span class="nn">deep_macrofin</span> <span class="kn">import</span> <span class="n">ActivationType</span><span class="p">,</span> <span class="n">LayerType</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="c1"># ActivationType.ReLU = &quot;relu&quot; (nn.ReLU)</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="c1"># ActivationType.SiLU = &quot;silu&quot; (nn.SiLU)</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="c1"># ActivationType.Sigmoid = &quot;sigmoid&quot; (nn.Sigmoid)</span>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="c1"># ActivationType.Tanh = &quot;tanh&quot; (nn.Tanh)</span>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="c1"># ActivationType.Wavelet=&quot;wavelet&quot; (w1*sin(x)+w2*cos(x), where w1 and w2 are learnable)</span>
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a>
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a><span class="c1"># LayerType.MLP = &quot;MLP&quot;</span>
</span><span id="__span-13-9"><a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a><span class="c1"># LayerType.KAN = &quot;KAN&quot;</span>
</span><span id="__span-13-10"><a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a><span class="c1"># LayerType.MultKAN=&quot;MultKAN&quot;</span>
</span></code></pre></div></p>
<p>Similar to PDEModel defintion, we can override any of the settings by passing a dictionary to the <code>config</code> parameter.</p>
<p>In the following setup, <code>xih</code> is defined to be a 2-layer MLP. Each layer contains 40 hidden units and is activated by SiLU.
Its output is restricted to be positive only by SoftPlus.
Suppose the state variable is <span class="arithmatex">\(x\)</span>, then four derivatives are computed: <code>xih_x</code>, <code>xih_xx</code>, <code>xih_xxx</code>, <code>xih_xxxx</code>. 
<code>qa</code> is defined as a 2-layer KAN. The input and output sizes are restricted to 1, and there are two layers of width 5.
<div class="language-py highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="n">pde_model</span><span class="o">.</span><span class="n">add_agent</span><span class="p">(</span><span class="s2">&quot;xih&quot;</span><span class="p">,</span> 
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>    <span class="n">config</span><span class="o">=</span><span class="p">{</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a>        <span class="s2">&quot;hidden_units&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">40</span><span class="p">,</span> <span class="mi">40</span><span class="p">],</span> 
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>        <span class="s2">&quot;activation_type&quot;</span><span class="p">:</span> <span class="n">ActivationType</span><span class="o">.</span><span class="n">SiLU</span><span class="p">,</span> 
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a>        <span class="s2">&quot;positive&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> 
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a>        <span class="s2">&quot;derivative_order&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">}</span>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a><span class="p">)</span> 
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a><span class="n">pde_model</span><span class="o">.</span><span class="n">add_endog</span><span class="p">(</span><span class="s2">&quot;qa&quot;</span><span class="p">,</span> 
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a>    <span class="n">config</span><span class="o">=</span><span class="p">{</span>
</span><span id="__span-14-10"><a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a>        <span class="s2">&quot;hidden_units&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> 
</span><span id="__span-14-11"><a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a>        <span class="s2">&quot;layer_type&quot;</span><span class="p">:</span> <span class="n">LayerType</span><span class="o">.</span><span class="n">KAN</span><span class="p">}</span>
</span><span id="__span-14-12"><a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a><span class="p">)</span>
</span></code></pre></div></p>
<h3 id="defining-multiple-agentsendogvars">Defining Multiple Agents/EndogVars</h3>
<p>Multiple agents and endogenous variables with different configurations can be added to PDEModel at the same time using <code>add_agents</code> (<a href="../api/pde_model/#add_agents">API</a>) and <code>add_endogs</code> (<a href="../api/pde_model/#add_endogs">API</a>). The following code adds two agents <code>"xii", "xih"</code>, and five endogenous variables <code>"mue", "qa", "wia", "wha", "sigea"</code> to a PDEModel.
<div class="language-py highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="n">pde_model</span><span class="o">.</span><span class="n">add_agents</span><span class="p">([</span><span class="s2">&quot;xii&quot;</span><span class="p">,</span> <span class="s2">&quot;xih&quot;</span><span class="p">],</span> 
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>    <span class="p">{</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>        <span class="s2">&quot;xii&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;positive&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span> 
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>        <span class="s2">&quot;xih&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;positive&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a>    <span class="p">}</span>
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a><span class="p">)</span>
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a><span class="n">pde_model</span><span class="o">.</span><span class="n">add_endogs</span><span class="p">([</span><span class="s2">&quot;mue&quot;</span><span class="p">,</span> <span class="s2">&quot;qa&quot;</span><span class="p">,</span> <span class="s2">&quot;wia&quot;</span><span class="p">,</span> <span class="s2">&quot;wha&quot;</span><span class="p">,</span> <span class="s2">&quot;sigea&quot;</span><span class="p">],</span> 
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a>    <span class="p">{</span><span class="s2">&quot;qa&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;positive&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}})</span>
</span></code></pre></div></p>
<p>The parameter <code>configs</code> is now a multi-level dictionary, <code>{var1_name: {var1_configs}, var2_name: {var2_configs}, ...}</code>. Any configurations not provided by the user are set as default. </p>
<h3 id="conditions-for-agentendogvar">Conditions for Agent/EndogVar</h3>
<p><code>add_agent_condition</code> (<a href="../api/pde_model/#add_agent_condition">API</a>) and <code>add_endog_condition</code> (<a href="../api/pde_model/#add_endog_condition">API</a>) can be used for adding conditions (initial and boundary conditions, and any point that requires specific values)</p>
<p>The following code adds a condition on a 1D endogenous variable <span class="arithmatex">\(y\)</span>: <span class="arithmatex">\(y(0)=1\)</span>. The key <code>SV</code> can be replaced by any variable that is not used in the system. For example, if <code>lhs</code> is defined as <code>"y(X)"</code>, then <code>lhs_state</code> should be replaced with <code>{"X": torch.zeros((1, 1))}</code>. Because rhs is a constant 1, there is no need for any <code>rhs_state</code> definition. An empty dictionary suffices. <code>weight=2</code> means the computed loss will have weight 2 in the PDEModel.
<div class="language-py highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="n">pde_model</span><span class="o">.</span><span class="n">add_endog_condition</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> 
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>    <span class="s2">&quot;y(SV)&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;SV&quot;</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))},</span> 
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>    <span class="n">Comparator</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> 
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>    <span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="p">{},</span> 
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>    <span class="n">weight</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span></code></pre></div></p>
<p><code>Comparator</code> is a <code>Enum</code> object that can be imported from the package.
<div class="language-py highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="kn">from</span> <span class="nn">deep_macrofin</span> <span class="kn">import</span> <span class="n">Comparator</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="c1"># Comparator.LEQ = &quot;&lt;=&quot;</span>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="c1"># Comparator.GEQ = &quot;&gt;=&quot;</span>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="c1"># Comparator.LT = &quot;&lt;&quot;</span>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="c1"># Comparator.GT = &quot;&gt;&quot;</span>
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="c1"># Comparator.EQ = &quot;=&quot;</span>
</span></code></pre></div></p>
<p>The following code adds a condition on a 2D endogenous variable <span class="arithmatex">\(z\)</span> s.t. <span class="arithmatex">\(z(0, y)\leq y\)</span> <span class="arithmatex">\(\forall y\in[0,1]\)</span>. Batch size is set to 100 here, but can be finetuned to get better accuracy. Each element in the batch requires two state variables. The first variable is <span class="arithmatex">\(x=0\)</span>, and the second variable <span class="arithmatex">\(y\)</span> is set to be a linear space from 0 to 1. RHS is replaced with <code>zero_x[:, 1:2]</code> as <span class="arithmatex">\(y\)</span>.
<div class="language-py highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="n">zero_x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> 
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="n">zero_x</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">100</span><span class="p">))</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="n">pde_model</span><span class="o">.</span><span class="n">add_endog_condition</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> 
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a>    <span class="s2">&quot;y(SV)&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;SV&quot;</span><span class="p">:</span> <span class="n">zero_x</span><span class="p">},</span> 
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a>    <span class="n">Comparator</span><span class="o">.</span><span class="n">LEQ</span><span class="p">,</span> 
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a>    <span class="s2">&quot;rhs&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;rhs&quot;</span><span class="p">:</span> <span class="n">zero_x</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">]}</span>
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a><span class="p">)</span>
</span></code></pre></div></p>
<h2 id="add-equations-etc">Add Equations, etc</h2>
<p><strong>Note</strong>: 
- When an equation is provided using LaTex, it must be enclosed by <code>$</code> and defined as a raw string <code>r""</code>
- Derivatives should be provided as <code>"y_x"</code> or <code>"y_xx"</code> in raw python strings, or <code>"\frac{\partial y}{\partial x}"</code> or <code>"\frac{\partial^2 y}{\partial x^2}"</code> in LaTex strings.</p>
<p><code>add_param</code> (<a href="../api/pde_model/#add_param">API</a>) and <code>add_params</code> (<a href="../api/pde_model/#add_params">API</a>) are used to define constant parameters.<br />
<code>add_equation</code> (<a href="../api/pde_model/#add_equation">API</a>) defines new variables through an equation.  </p>
<p>The following adds two parameters <code>zetai=1.0005</code> (<span class="arithmatex">\(\zeta^i\)</span>) and <code>gammai=2</code> (<span class="arithmatex">\(\gamma^i\)</span>) to the system, and defines a new variable <span class="arithmatex">\(y=\zeta^i + \gamma^i\)</span> in the system. 
<div class="language-py highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="kn">from</span> <span class="nn">deep_macrofin</span> <span class="kn">import</span> <span class="n">PDEModel</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="n">latex_var_mapping</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a>    <span class="sa">r</span><span class="s2">&quot;\zeta^i&quot;</span><span class="p">:</span> <span class="s2">&quot;zetai&quot;</span><span class="p">,</span>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a>    <span class="sa">r</span><span class="s2">&quot;\gamma^i&quot;</span><span class="p">:</span> <span class="s2">&quot;gammai&quot;</span>
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="p">}</span> <span class="c1"># define mapping</span>
</span><span id="__span-19-6"><a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a><span class="n">pde_model</span> <span class="o">=</span> <span class="n">PDEModel</span><span class="p">(</span><span class="s2">&quot;model_name&quot;</span><span class="p">,</span> <span class="n">latex_var_mapping</span><span class="o">=</span><span class="n">latex_var_mapping</span><span class="p">)</span>
</span><span id="__span-19-7"><a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a><span class="n">pde_model</span><span class="o">.</span><span class="n">add_params</span><span class="p">({</span>
</span><span id="__span-19-8"><a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a>    <span class="s2">&quot;zetai&quot;</span><span class="p">:</span> <span class="mf">1.0005</span><span class="p">,</span>
</span><span id="__span-19-9"><a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a>    <span class="s2">&quot;gammai&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="__span-19-10"><a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a><span class="p">})</span>
</span><span id="__span-19-11"><a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a><span class="c1"># The following two equations are equivalent.</span>
</span><span id="__span-19-12"><a id="__codelineno-19-12" name="__codelineno-19-12" href="#__codelineno-19-12"></a><span class="c1"># DO NOT copy and run the following code, because double definition could cause errors in the model</span>
</span><span id="__span-19-13"><a id="__codelineno-19-13" name="__codelineno-19-13" href="#__codelineno-19-13"></a><span class="n">pde_model</span><span class="o">.</span><span class="n">add_equation</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$y=\zeta^i + \gamma^i$&quot;</span><span class="p">)</span> <span class="c1"># latex version</span>
</span><span id="__span-19-14"><a id="__codelineno-19-14" name="__codelineno-19-14" href="#__codelineno-19-14"></a><span class="n">pde_model</span><span class="o">.</span><span class="n">add_equation</span><span class="p">(</span><span class="s2">&quot;y=zetai+gammai&quot;</span><span class="p">)</span> <span class="c1"># pure python version</span>
</span></code></pre></div></p>
<p><code>add_endog_equation</code> (<a href="../api/pde_model/#add_endog_equation">API</a>) defines endogenous equations (algebraic equations) that must be satisfied by the system.<br />
<code>add_hjb_equation</code> (<a href="../api/pde_model/#add_hjb_equation">API</a>) defines HJB equation to maximize/minimize for each agent.
<code>add_system</code> (<a href="../api/pde_model/#add_system">API</a>) defines constraint-activated systems to handle different components of a system.</p>
<p>Endogenous equations, constraints, HJB equations and systems are used to compute losses.</p>
<p>The following code defines an endogenous equation</p>
<div class="arithmatex">\[y'' + 6y' + 5*y = 0\]</div>
<div class="language-py highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="n">pde_model</span><span class="o">.</span><span class="n">add_endog_equation</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\frac{\partial^2 y}{\partial x^2} + 6 * \frac{\partial y}{\partial x} + 5 * y =0$&quot;</span><span class="p">)</span> <span class="c1"># latex version</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="n">pde_model</span><span class="o">.</span><span class="n">add_endog_equation</span><span class="p">(</span><span class="s2">&quot;y_xx+6*y_x+5*y=0&quot;</span><span class="p">)</span> <span class="c1"># pure python version</span>
</span></code></pre></div>
<p>The following code defines an HJB equation to maximize</p>
<div class="arithmatex">\[\frac{\rho^i}{1-\frac{1}{\zeta^i}} * \left( \left(\frac{c_t^i}{\xi_t^i} \right)^{1-1/\zeta^i}-1 \right) + \mu_t^{\xi i} +  \mu_t^{ni} - \frac{\gamma^i}{2} * (\sigma_t^{nia})^2  - \frac{\gamma^i}{2} * (\sigma_t^{\xi ia})^2\]</div>
<div class="language-py highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="c1"># Note: proper parsing of variables are required. See 1D Economic Problem for full example.</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="n">pde_model</span><span class="o">.</span><span class="n">add_hjb_equation</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\frac{\rho^i}{1-\frac</span><span class="si">{1}</span><span class="s2">{\zeta^i}} * \left( \left(\frac{c_t^i}{\xi_t^i} \right)^{1-1/\zeta^i}-1 \right) + \mu_t^{\xi i} +  \mu_t^</span><span class="si">{ni}</span><span class="s2"> - \frac{\gamma^i}</span><span class="si">{2}</span><span class="s2"> * (\sigma_t^</span><span class="si">{nia}</span><span class="s2">)^2  - \frac{\gamma^i}</span><span class="si">{2}</span><span class="s2"> * (\sigma_t^{\xi ia})^2$&quot;</span><span class="p">)</span>
</span></code></pre></div>
<p>The systems (<a href="../api/evaluations/#system">API</a>) are defined using activation constraints. <br />
The following code defines a system that is activated when <span class="arithmatex">\(\frac{\partial y}{\partial x} \geq 0\)</span> and <span class="arithmatex">\(x \in [0,0.5]\)</span>, and computes <span class="arithmatex">\(z=x^2y\)</span>, requiring <span class="arithmatex">\(y+z = 1\)</span> in this case.</p>
<div class="language-py highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="kn">from</span> <span class="nn">deep_macrofin</span> <span class="kn">import</span> <span class="n">System</span><span class="p">,</span> <span class="n">Constraint</span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="c1"># because the systems are separated from the main PDEModel when being defined, labels are required when initializing the constraints and the system.</span>
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="n">s</span> <span class="o">=</span> <span class="n">System</span><span class="p">([</span>
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a>    <span class="n">Constraint</span><span class="p">(</span><span class="s2">&quot;y_x&quot;</span><span class="p">,</span> <span class="n">Comparator</span><span class="o">.</span><span class="n">GEQ</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">),</span> <span class="c1"># y_x&gt;=0</span>
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a>    <span class="n">Constraint</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">Comparator</span><span class="o">.</span><span class="n">GEQ</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">),</span> <span class="c1"># x&gt;= 0</span>
</span><span id="__span-22-6"><a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a>    <span class="n">Constraint</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">Comparator</span><span class="o">.</span><span class="n">LEQ</span><span class="p">,</span> <span class="s2">&quot;0.5&quot;</span><span class="p">),</span> <span class="c1"># x&lt;=0.5</span>
</span><span id="__span-22-7"><a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a>    <span class="p">],</span> <span class="s2">&quot;sys1&quot;</span><span class="p">)</span>
</span><span id="__span-22-8"><a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a><span class="n">s</span><span class="o">.</span><span class="n">add_equation</span><span class="p">(</span><span class="s2">&quot;z=x**2 * y&quot;</span><span class="p">)</span> 
</span><span id="__span-22-9"><a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a><span class="n">s</span><span class="o">.</span><span class="n">add_endog_equation</span><span class="p">(</span><span class="s2">&quot;y+z = 1&quot;</span><span class="p">)</span>
</span><span id="__span-22-10"><a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a><span class="n">pde_model</span><span class="o">.</span><span class="n">add_system</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="c1"># add the system to PDEModel</span>
</span></code></pre></div>
<h3 id="about-labels">About Labels</h3>
<p>For all equations, conditions, etc added to the model, there is an optional parameter <code>label</code> used to identify the equations. This can be automatically set based on the sequence the equation is added to the system, and usually doesn't need to be set by the user. 
<div class="language-py highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="n">pde_model</span><span class="o">.</span><span class="n">add_equation</span><span class="p">(</span><span class="s2">&quot;y=x+1&quot;</span><span class="p">)</span> <span class="c1"># eq_1 is y=x+1</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="n">pde_model</span><span class="o">.</span><span class="n">add_equation</span><span class="p">(</span><span class="s2">&quot;z=y*2&quot;</span><span class="p">)</span> <span class="c1"># eq_2 is z=y*2</span>
</span></code></pre></div></p>
<h3 id="defining-derivatives-with-equations">Defining Derivatives with Equations</h3>
<p>By default, only parametrized functions have derivatives w.r.t. state variables as shown in <a href="#define-agentendogvar">Define Agent/EndogVar</a>. However, we can also define implicit derivatives using equations and a function macro <code>deriv(y, x)</code>. For derivatives w.r.t. state variables, <code>x</code> needs to be set to <code>SV</code> explicitly, and array indexing is required in equation strings. </p>
<div class="language-py highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="n">pde_model</span><span class="o">.</span><span class="n">set_state</span><span class="p">([</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">])</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="n">pde_model</span><span class="o">.</span><span class="n">add_endog</span><span class="p">(</span><span class="s2">&quot;k&quot;</span><span class="p">)</span>
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a><span class="n">pde_model</span><span class="o">.</span><span class="n">add_equation</span><span class="p">(</span><span class="s2">&quot;q=k/x&quot;</span><span class="p">)</span>
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a><span class="n">pde_model</span><span class="o">.</span><span class="n">add_equation</span><span class="p">(</span><span class="s2">&quot;p=k*y&quot;</span><span class="p">)</span>
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a><span class="n">pde_model</span><span class="o">.</span><span class="n">add_equation</span><span class="p">(</span><span class="s2">&quot;q_k=deriv(q, k)&quot;</span><span class="p">)</span> <span class="c1"># this computes the derivative dq/dk</span>
</span><span id="__span-24-6"><a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a><span class="n">pde_model</span><span class="o">.</span><span class="n">add_equation</span><span class="p">(</span><span class="s2">&quot;q_x=deriv(q, SV)[:,:1]&quot;</span><span class="p">)</span> <span class="c1"># this computes the derivative dq/dx, which is q w.r.t. the first state variable x</span>
</span><span id="__span-24-7"><a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a><span class="n">pde_model</span><span class="o">.</span><span class="n">add_equation</span><span class="p">(</span><span class="s2">&quot;q_xy=deriv(q_x, SV)[:,1:2]&quot;</span><span class="p">)</span> <span class="c1"># this computes the derivative d^2q/(dxdy)</span>
</span><span id="__span-24-8"><a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a><span class="n">pde_model</span><span class="o">.</span><span class="n">add_equation</span><span class="p">(</span><span class="s2">&quot;p_y=deriv(p, SV)[:,1:2]&quot;</span><span class="p">)</span> <span class="c1"># this computes the derivative dp/dy, which is p w.r.t. the second state variable y</span>
</span><span id="__span-24-9"><a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a><span class="n">pde_model</span><span class="o">.</span><span class="n">add_equation</span><span class="p">(</span><span class="s2">&quot;p_xy=deriv(p_y, SV)[:,:1]&quot;</span><span class="p">)</span> <span class="c1"># this computes the derivative d^2p/(dxdy)</span>
</span></code></pre></div>
<h2 id="training-and-evaluation">Training and Evaluation</h2>
<p>After the model is defined, <code>train_model</code> (<a href="../api/pde_model/#train_model">API</a>) can be used to train the models, and <code>eval_model</code> (<a href="../api/pde_model/#eval_model">API</a>) can be used to eval models. 
<code>load_model</code> (<a href="../api/pde_model/#load_model">API</a>) can be used to load a trained model. It will overwrite existing agent/endogenous variables in the PDEModel.</p>
<p><code>train_model</code> will print out the full model configurations and save the best and final models. Losses are logged every <code>loss_log_interval</code> epochs during training in <code>modelname_loss.csv</code> file for plotting. Minimum (converging) losses are logged in a separate <code>modelname_min_loss.csv</code> file. Examples can be found in <a href="../examples/approx/discont/">Basic Examples</a>.</p>
<h3 id="print-the-model">Print the Model</h3>
<p>For easier debugging on the model setup and equation typing, <code>print(pde_model)</code> prints out a detailed configuration of the model. The following is a sample print out of <a href="../examples/macrofinance_models/log_utility/">log utility problem</a>. The same summary is logged in the log file for each model. </p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a>=====================Summary of Model BruSan14_log_utility======================
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a>Config: {
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a> &quot;batch_size&quot;: 100,
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a> &quot;num_epochs&quot;: 100,
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a> &quot;lr&quot;: 0.001,
</span><span id="__span-25-6"><a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a> &quot;loss_log_interval&quot;: 10,
</span><span id="__span-25-7"><a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a> &quot;optimizer_type&quot;: &quot;Adam&quot;
</span><span id="__span-25-8"><a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a>}
</span><span id="__span-25-9"><a id="__codelineno-25-9" name="__codelineno-25-9" href="#__codelineno-25-9"></a>Latex Variable Mapping:
</span><span id="__span-25-10"><a id="__codelineno-25-10" name="__codelineno-25-10" href="#__codelineno-25-10"></a>{
</span><span id="__span-25-11"><a id="__codelineno-25-11" name="__codelineno-25-11" href="#__codelineno-25-11"></a> &quot;\\sigma_t^q&quot;: &quot;sigq&quot;,
</span><span id="__span-25-12"><a id="__codelineno-25-12" name="__codelineno-25-12" href="#__codelineno-25-12"></a> &quot;\\sigma_t^\\theta&quot;: &quot;sigtheta&quot;,
</span><span id="__span-25-13"><a id="__codelineno-25-13" name="__codelineno-25-13" href="#__codelineno-25-13"></a> &quot;\\sigma_t^\\eta&quot;: &quot;sige&quot;,
</span><span id="__span-25-14"><a id="__codelineno-25-14" name="__codelineno-25-14" href="#__codelineno-25-14"></a> &quot;\\mu_t^\\eta&quot;: &quot;mue&quot;,
</span><span id="__span-25-15"><a id="__codelineno-25-15" name="__codelineno-25-15" href="#__codelineno-25-15"></a> &quot;\\mu_t^q&quot;: &quot;muq&quot;,
</span><span id="__span-25-16"><a id="__codelineno-25-16" name="__codelineno-25-16" href="#__codelineno-25-16"></a> &quot;\\mu_t^\\theta&quot;: &quot;mutheta&quot;,
</span><span id="__span-25-17"><a id="__codelineno-25-17" name="__codelineno-25-17" href="#__codelineno-25-17"></a> &quot;\\rho&quot;: &quot;rho&quot;,
</span><span id="__span-25-18"><a id="__codelineno-25-18" name="__codelineno-25-18" href="#__codelineno-25-18"></a> &quot;\\underline{a}&quot;: &quot;ah&quot;,
</span><span id="__span-25-19"><a id="__codelineno-25-19" name="__codelineno-25-19" href="#__codelineno-25-19"></a> &quot;\\underline{\\delta}&quot;: &quot;deltah&quot;,
</span><span id="__span-25-20"><a id="__codelineno-25-20" name="__codelineno-25-20" href="#__codelineno-25-20"></a> &quot;\\delta&quot;: &quot;deltae&quot;,
</span><span id="__span-25-21"><a id="__codelineno-25-21" name="__codelineno-25-21" href="#__codelineno-25-21"></a> &quot;\\sigma&quot;: &quot;sig&quot;,
</span><span id="__span-25-22"><a id="__codelineno-25-22" name="__codelineno-25-22" href="#__codelineno-25-22"></a> &quot;\\kappa&quot;: &quot;kappa&quot;,
</span><span id="__span-25-23"><a id="__codelineno-25-23" name="__codelineno-25-23" href="#__codelineno-25-23"></a> &quot;\\eta&quot;: &quot;e&quot;,
</span><span id="__span-25-24"><a id="__codelineno-25-24" name="__codelineno-25-24" href="#__codelineno-25-24"></a> &quot;\\theta&quot;: &quot;theta&quot;,
</span><span id="__span-25-25"><a id="__codelineno-25-25" name="__codelineno-25-25" href="#__codelineno-25-25"></a> &quot;\\psi&quot;: &quot;psi&quot;,
</span><span id="__span-25-26"><a id="__codelineno-25-26" name="__codelineno-25-26" href="#__codelineno-25-26"></a> &quot;\\iota&quot;: &quot;iota&quot;,
</span><span id="__span-25-27"><a id="__codelineno-25-27" name="__codelineno-25-27" href="#__codelineno-25-27"></a> &quot;\\Phi&quot;: &quot;phi&quot;
</span><span id="__span-25-28"><a id="__codelineno-25-28" name="__codelineno-25-28" href="#__codelineno-25-28"></a>}
</span><span id="__span-25-29"><a id="__codelineno-25-29" name="__codelineno-25-29" href="#__codelineno-25-29"></a>User Defined Parameters:
</span><span id="__span-25-30"><a id="__codelineno-25-30" name="__codelineno-25-30" href="#__codelineno-25-30"></a>{
</span><span id="__span-25-31"><a id="__codelineno-25-31" name="__codelineno-25-31" href="#__codelineno-25-31"></a> &quot;sig&quot;: 0.1,
</span><span id="__span-25-32"><a id="__codelineno-25-32" name="__codelineno-25-32" href="#__codelineno-25-32"></a> &quot;deltae&quot;: 0.05,
</span><span id="__span-25-33"><a id="__codelineno-25-33" name="__codelineno-25-33" href="#__codelineno-25-33"></a> &quot;deltah&quot;: 0.05,
</span><span id="__span-25-34"><a id="__codelineno-25-34" name="__codelineno-25-34" href="#__codelineno-25-34"></a> &quot;rho&quot;: 0.06,
</span><span id="__span-25-35"><a id="__codelineno-25-35" name="__codelineno-25-35" href="#__codelineno-25-35"></a> &quot;r&quot;: 0.05,
</span><span id="__span-25-36"><a id="__codelineno-25-36" name="__codelineno-25-36" href="#__codelineno-25-36"></a> &quot;a&quot;: 0.11,
</span><span id="__span-25-37"><a id="__codelineno-25-37" name="__codelineno-25-37" href="#__codelineno-25-37"></a> &quot;ah&quot;: 0.07,
</span><span id="__span-25-38"><a id="__codelineno-25-38" name="__codelineno-25-38" href="#__codelineno-25-38"></a> &quot;kappa&quot;: 2
</span><span id="__span-25-39"><a id="__codelineno-25-39" name="__codelineno-25-39" href="#__codelineno-25-39"></a>}
</span><span id="__span-25-40"><a id="__codelineno-25-40" name="__codelineno-25-40" href="#__codelineno-25-40"></a>
</span><span id="__span-25-41"><a id="__codelineno-25-41" name="__codelineno-25-41" href="#__codelineno-25-41"></a>================================State Variables=================================
</span><span id="__span-25-42"><a id="__codelineno-25-42" name="__codelineno-25-42" href="#__codelineno-25-42"></a>e: [0.0, 1.0]
</span><span id="__span-25-43"><a id="__codelineno-25-43" name="__codelineno-25-43" href="#__codelineno-25-43"></a>
</span><span id="__span-25-44"><a id="__codelineno-25-44" name="__codelineno-25-44" href="#__codelineno-25-44"></a>=====================================Agents=====================================
</span><span id="__span-25-45"><a id="__codelineno-25-45" name="__codelineno-25-45" href="#__codelineno-25-45"></a>
</span><span id="__span-25-46"><a id="__codelineno-25-46" name="__codelineno-25-46" href="#__codelineno-25-46"></a>================================Agent Conditions================================
</span><span id="__span-25-47"><a id="__codelineno-25-47" name="__codelineno-25-47" href="#__codelineno-25-47"></a>
</span><span id="__span-25-48"><a id="__codelineno-25-48" name="__codelineno-25-48" href="#__codelineno-25-48"></a>==============================Endogenous Variables==============================
</span><span id="__span-25-49"><a id="__codelineno-25-49" name="__codelineno-25-49" href="#__codelineno-25-49"></a>Endogenous Variable Name: q
</span><span id="__span-25-50"><a id="__codelineno-25-50" name="__codelineno-25-50" href="#__codelineno-25-50"></a>EndogVar(
</span><span id="__span-25-51"><a id="__codelineno-25-51" name="__codelineno-25-51" href="#__codelineno-25-51"></a>  (model): Sequential(
</span><span id="__span-25-52"><a id="__codelineno-25-52" name="__codelineno-25-52" href="#__codelineno-25-52"></a>    (linear_0): Linear(in_features=1, out_features=30, bias=True)
</span><span id="__span-25-53"><a id="__codelineno-25-53" name="__codelineno-25-53" href="#__codelineno-25-53"></a>    (activation_0): Tanh()
</span><span id="__span-25-54"><a id="__codelineno-25-54" name="__codelineno-25-54" href="#__codelineno-25-54"></a>    (linear_1): Linear(in_features=30, out_features=30, bias=True)
</span><span id="__span-25-55"><a id="__codelineno-25-55" name="__codelineno-25-55" href="#__codelineno-25-55"></a>    (activation_1): Tanh()
</span><span id="__span-25-56"><a id="__codelineno-25-56" name="__codelineno-25-56" href="#__codelineno-25-56"></a>    (linear_2): Linear(in_features=30, out_features=30, bias=True)
</span><span id="__span-25-57"><a id="__codelineno-25-57" name="__codelineno-25-57" href="#__codelineno-25-57"></a>    (activation_2): Tanh()
</span><span id="__span-25-58"><a id="__codelineno-25-58" name="__codelineno-25-58" href="#__codelineno-25-58"></a>    (linear_3): Linear(in_features=30, out_features=30, bias=True)
</span><span id="__span-25-59"><a id="__codelineno-25-59" name="__codelineno-25-59" href="#__codelineno-25-59"></a>    (activation_3): Tanh()
</span><span id="__span-25-60"><a id="__codelineno-25-60" name="__codelineno-25-60" href="#__codelineno-25-60"></a>    (final_layer): Linear(in_features=30, out_features=1, bias=True)
</span><span id="__span-25-61"><a id="__codelineno-25-61" name="__codelineno-25-61" href="#__codelineno-25-61"></a>    (positive_act): Softplus(beta=1.0, threshold=20.0)
</span><span id="__span-25-62"><a id="__codelineno-25-62" name="__codelineno-25-62" href="#__codelineno-25-62"></a>  )
</span><span id="__span-25-63"><a id="__codelineno-25-63" name="__codelineno-25-63" href="#__codelineno-25-63"></a>)
</span><span id="__span-25-64"><a id="__codelineno-25-64" name="__codelineno-25-64" href="#__codelineno-25-64"></a>Num parameters: 2881
</span><span id="__span-25-65"><a id="__codelineno-25-65" name="__codelineno-25-65" href="#__codelineno-25-65"></a>--------------------------------------------------------------------------------
</span><span id="__span-25-66"><a id="__codelineno-25-66" name="__codelineno-25-66" href="#__codelineno-25-66"></a>Endogenous Variable Name: psi
</span><span id="__span-25-67"><a id="__codelineno-25-67" name="__codelineno-25-67" href="#__codelineno-25-67"></a>EndogVar(
</span><span id="__span-25-68"><a id="__codelineno-25-68" name="__codelineno-25-68" href="#__codelineno-25-68"></a>  (model): Sequential(
</span><span id="__span-25-69"><a id="__codelineno-25-69" name="__codelineno-25-69" href="#__codelineno-25-69"></a>    (linear_0): Linear(in_features=1, out_features=30, bias=True)
</span><span id="__span-25-70"><a id="__codelineno-25-70" name="__codelineno-25-70" href="#__codelineno-25-70"></a>    (activation_0): Tanh()
</span><span id="__span-25-71"><a id="__codelineno-25-71" name="__codelineno-25-71" href="#__codelineno-25-71"></a>    (linear_1): Linear(in_features=30, out_features=30, bias=True)
</span><span id="__span-25-72"><a id="__codelineno-25-72" name="__codelineno-25-72" href="#__codelineno-25-72"></a>    (activation_1): Tanh()
</span><span id="__span-25-73"><a id="__codelineno-25-73" name="__codelineno-25-73" href="#__codelineno-25-73"></a>    (linear_2): Linear(in_features=30, out_features=30, bias=True)
</span><span id="__span-25-74"><a id="__codelineno-25-74" name="__codelineno-25-74" href="#__codelineno-25-74"></a>    (activation_2): Tanh()
</span><span id="__span-25-75"><a id="__codelineno-25-75" name="__codelineno-25-75" href="#__codelineno-25-75"></a>    (linear_3): Linear(in_features=30, out_features=30, bias=True)
</span><span id="__span-25-76"><a id="__codelineno-25-76" name="__codelineno-25-76" href="#__codelineno-25-76"></a>    (activation_3): Tanh()
</span><span id="__span-25-77"><a id="__codelineno-25-77" name="__codelineno-25-77" href="#__codelineno-25-77"></a>    (final_layer): Linear(in_features=30, out_features=1, bias=True)
</span><span id="__span-25-78"><a id="__codelineno-25-78" name="__codelineno-25-78" href="#__codelineno-25-78"></a>    (positive_act): Softplus(beta=1.0, threshold=20.0)
</span><span id="__span-25-79"><a id="__codelineno-25-79" name="__codelineno-25-79" href="#__codelineno-25-79"></a>  )
</span><span id="__span-25-80"><a id="__codelineno-25-80" name="__codelineno-25-80" href="#__codelineno-25-80"></a>)
</span><span id="__span-25-81"><a id="__codelineno-25-81" name="__codelineno-25-81" href="#__codelineno-25-81"></a>Num parameters: 2881
</span><span id="__span-25-82"><a id="__codelineno-25-82" name="__codelineno-25-82" href="#__codelineno-25-82"></a>--------------------------------------------------------------------------------
</span><span id="__span-25-83"><a id="__codelineno-25-83" name="__codelineno-25-83" href="#__codelineno-25-83"></a>
</span><span id="__span-25-84"><a id="__codelineno-25-84" name="__codelineno-25-84" href="#__codelineno-25-84"></a>========================Endogenous Variables Conditions=========================
</span><span id="__span-25-85"><a id="__codelineno-25-85" name="__codelineno-25-85" href="#__codelineno-25-85"></a>endogvar_q_cond_q_min: q(SV)=(2*ah*kappa + (kappa*r)**2 + 1)**0.5 - kappa*r with LHS evaluated at SV=[[0.0]] and RHS evaluated at sig=0.1deltae=0.05deltah=0.05rho=0.06r=0.05a=0.11ah=0.07kappa=2
</span><span id="__span-25-86"><a id="__codelineno-25-86" name="__codelineno-25-86" href="#__codelineno-25-86"></a>Loss weight: 1.0
</span><span id="__span-25-87"><a id="__codelineno-25-87" name="__codelineno-25-87" href="#__codelineno-25-87"></a>--------------------------------------------------------------------------------
</span><span id="__span-25-88"><a id="__codelineno-25-88" name="__codelineno-25-88" href="#__codelineno-25-88"></a>
</span><span id="__span-25-89"><a id="__codelineno-25-89" name="__codelineno-25-89" href="#__codelineno-25-89"></a>===================================Equations====================================
</span><span id="__span-25-90"><a id="__codelineno-25-90" name="__codelineno-25-90" href="#__codelineno-25-90"></a>eq_1: 
</span><span id="__span-25-91"><a id="__codelineno-25-91" name="__codelineno-25-91" href="#__codelineno-25-91"></a>Raw input: $\iota = \frac{q^2-1}{ 2 * \kappa}$
</span><span id="__span-25-92"><a id="__codelineno-25-92" name="__codelineno-25-92" href="#__codelineno-25-92"></a>Parsed: iota=(q**(2)-1)/( 2 * kappa)
</span><span id="__span-25-93"><a id="__codelineno-25-93" name="__codelineno-25-93" href="#__codelineno-25-93"></a>eq_2: 
</span><span id="__span-25-94"><a id="__codelineno-25-94" name="__codelineno-25-94" href="#__codelineno-25-94"></a>Raw input: $\sigma_t^q = \frac{\sigma}{1 - \frac{1}{q} * \frac{\partial q}{\partial \eta} * (\psi - \eta)} - \sigma$
</span><span id="__span-25-95"><a id="__codelineno-25-95" name="__codelineno-25-95" href="#__codelineno-25-95"></a>Parsed: sigq=(sig)/(1 - (1)/(q) * q_e * (psi - e)) - sig
</span><span id="__span-25-96"><a id="__codelineno-25-96" name="__codelineno-25-96" href="#__codelineno-25-96"></a>eq_3: 
</span><span id="__span-25-97"><a id="__codelineno-25-97" name="__codelineno-25-97" href="#__codelineno-25-97"></a>Raw input: $\sigma_t^\eta = \frac{\psi - \eta}{\eta} * (\sigma + \sigma_t^q)$
</span><span id="__span-25-98"><a id="__codelineno-25-98" name="__codelineno-25-98" href="#__codelineno-25-98"></a>Parsed: sige=(psi - e)/(e) * (sig + sigq)
</span><span id="__span-25-99"><a id="__codelineno-25-99" name="__codelineno-25-99" href="#__codelineno-25-99"></a>eq_4: 
</span><span id="__span-25-100"><a id="__codelineno-25-100" name="__codelineno-25-100" href="#__codelineno-25-100"></a>Raw input: $\mu_t^\eta = (\sigma_t^\eta)^2 + \frac{a - \iota}{q} + (1-\psi) * (\underline{\delta} - \delta) - \rho$
</span><span id="__span-25-101"><a id="__codelineno-25-101" name="__codelineno-25-101" href="#__codelineno-25-101"></a>Parsed: mue=(sige)**(2) + (a - iota)/(q) + (1-psi) * (deltah - deltae) - rho
</span><span id="__span-25-102"><a id="__codelineno-25-102" name="__codelineno-25-102" href="#__codelineno-25-102"></a>
</span><span id="__span-25-103"><a id="__codelineno-25-103" name="__codelineno-25-103" href="#__codelineno-25-103"></a>==============================Endogenous Equations==============================
</span><span id="__span-25-104"><a id="__codelineno-25-104" name="__codelineno-25-104" href="#__codelineno-25-104"></a>endogeq_1: 
</span><span id="__span-25-105"><a id="__codelineno-25-105" name="__codelineno-25-105" href="#__codelineno-25-105"></a>Raw input: $(\sigma + \sigma_t^q) ^2 * (\psi / \eta - (1-\psi) / (1-\eta)) = \frac{a - \underline{a}}{q} + \underline{\delta} - \delta$
</span><span id="__span-25-106"><a id="__codelineno-25-106" name="__codelineno-25-106" href="#__codelineno-25-106"></a>Parsed: (sig + sigq) **(2) * (psi / e - (1-psi) / (1-e))=(a - ah)/(q) + deltah - deltae
</span><span id="__span-25-107"><a id="__codelineno-25-107" name="__codelineno-25-107" href="#__codelineno-25-107"></a>Loss weight: 1.0
</span><span id="__span-25-108"><a id="__codelineno-25-108" name="__codelineno-25-108" href="#__codelineno-25-108"></a>--------------------------------------------------------------------------------
</span><span id="__span-25-109"><a id="__codelineno-25-109" name="__codelineno-25-109" href="#__codelineno-25-109"></a>
</span><span id="__span-25-110"><a id="__codelineno-25-110" name="__codelineno-25-110" href="#__codelineno-25-110"></a>==================================Constraints===================================
</span><span id="__span-25-111"><a id="__codelineno-25-111" name="__codelineno-25-111" href="#__codelineno-25-111"></a>constraint_1: psi&lt;=1
</span><span id="__span-25-112"><a id="__codelineno-25-112" name="__codelineno-25-112" href="#__codelineno-25-112"></a>Loss weight: 1.0
</span><span id="__span-25-113"><a id="__codelineno-25-113" name="__codelineno-25-113" href="#__codelineno-25-113"></a>--------------------------------------------------------------------------------
</span><span id="__span-25-114"><a id="__codelineno-25-114" name="__codelineno-25-114" href="#__codelineno-25-114"></a>
</span><span id="__span-25-115"><a id="__codelineno-25-115" name="__codelineno-25-115" href="#__codelineno-25-115"></a>=================================HJB Equations==================================
</span><span id="__span-25-116"><a id="__codelineno-25-116" name="__codelineno-25-116" href="#__codelineno-25-116"></a>
</span><span id="__span-25-117"><a id="__codelineno-25-117" name="__codelineno-25-117" href="#__codelineno-25-117"></a>====================================Systems=====================================
</span><span id="__span-25-118"><a id="__codelineno-25-118" name="__codelineno-25-118" href="#__codelineno-25-118"></a>non-opt: 
</span><span id="__span-25-119"><a id="__codelineno-25-119" name="__codelineno-25-119" href="#__codelineno-25-119"></a>Activation Constraints:
</span><span id="__span-25-120"><a id="__codelineno-25-120" name="__codelineno-25-120" href="#__codelineno-25-120"></a>non-opt: psi&lt;1
</span><span id="__span-25-121"><a id="__codelineno-25-121" name="__codelineno-25-121" href="#__codelineno-25-121"></a>===============Equations================
</span><span id="__span-25-122"><a id="__codelineno-25-122" name="__codelineno-25-122" href="#__codelineno-25-122"></a>
</span><span id="__span-25-123"><a id="__codelineno-25-123" name="__codelineno-25-123" href="#__codelineno-25-123"></a>==========Endogenous Equations==========
</span><span id="__span-25-124"><a id="__codelineno-25-124" name="__codelineno-25-124" href="#__codelineno-25-124"></a>system_non-opt_endogeq_1: 
</span><span id="__span-25-125"><a id="__codelineno-25-125" name="__codelineno-25-125" href="#__codelineno-25-125"></a>Raw input: $(r*(1-\eta) + \rho * \eta) * q = \psi * a + (1-\psi) * \underline{a} - \iota$
</span><span id="__span-25-126"><a id="__codelineno-25-126" name="__codelineno-25-126" href="#__codelineno-25-126"></a>Parsed: (r*(1-e) + rho * e) * q=psi * a + (1-psi) * ah - iota
</span><span id="__span-25-127"><a id="__codelineno-25-127" name="__codelineno-25-127" href="#__codelineno-25-127"></a>Loss weight: 1.0
</span><span id="__span-25-128"><a id="__codelineno-25-128" name="__codelineno-25-128" href="#__codelineno-25-128"></a>----------------------------------------
</span><span id="__span-25-129"><a id="__codelineno-25-129" name="__codelineno-25-129" href="#__codelineno-25-129"></a>
</span><span id="__span-25-130"><a id="__codelineno-25-130" name="__codelineno-25-130" href="#__codelineno-25-130"></a>System loss weight: 1.0
</span><span id="__span-25-131"><a id="__codelineno-25-131" name="__codelineno-25-131" href="#__codelineno-25-131"></a>--------------------------------------------------------------------------------
</span><span id="__span-25-132"><a id="__codelineno-25-132" name="__codelineno-25-132" href="#__codelineno-25-132"></a>opt: 
</span><span id="__span-25-133"><a id="__codelineno-25-133" name="__codelineno-25-133" href="#__codelineno-25-133"></a>Activation Constraints:
</span><span id="__span-25-134"><a id="__codelineno-25-134" name="__codelineno-25-134" href="#__codelineno-25-134"></a>opt: psi&gt;=1
</span><span id="__span-25-135"><a id="__codelineno-25-135" name="__codelineno-25-135" href="#__codelineno-25-135"></a>===============Equations================
</span><span id="__span-25-136"><a id="__codelineno-25-136" name="__codelineno-25-136" href="#__codelineno-25-136"></a>
</span><span id="__span-25-137"><a id="__codelineno-25-137" name="__codelineno-25-137" href="#__codelineno-25-137"></a>==========Endogenous Equations==========
</span><span id="__span-25-138"><a id="__codelineno-25-138" name="__codelineno-25-138" href="#__codelineno-25-138"></a>system_opt_endogeq_1: 
</span><span id="__span-25-139"><a id="__codelineno-25-139" name="__codelineno-25-139" href="#__codelineno-25-139"></a>Raw input: $(r*(1-\eta) + \rho * \eta) * q = a - \iota$
</span><span id="__span-25-140"><a id="__codelineno-25-140" name="__codelineno-25-140" href="#__codelineno-25-140"></a>Parsed: (r*(1-e) + rho * e) * q=a - iota
</span><span id="__span-25-141"><a id="__codelineno-25-141" name="__codelineno-25-141" href="#__codelineno-25-141"></a>Loss weight: 1.0
</span><span id="__span-25-142"><a id="__codelineno-25-142" name="__codelineno-25-142" href="#__codelineno-25-142"></a>----------------------------------------
</span><span id="__span-25-143"><a id="__codelineno-25-143" name="__codelineno-25-143" href="#__codelineno-25-143"></a>
</span><span id="__span-25-144"><a id="__codelineno-25-144" name="__codelineno-25-144" href="#__codelineno-25-144"></a>System loss weight: 1.0
</span><span id="__span-25-145"><a id="__codelineno-25-145" name="__codelineno-25-145" href="#__codelineno-25-145"></a>--------------------------------------------------------------------------------
</span></code></pre></div>
<p>When errors are found in equation validation before training begins, the system will save an error log.</p>
<h2 id="plot">Plot</h2>
<p>Once the models are trained, there are several values that can be plotted. However, plottings are only supported for 1D and 2D models.</p>
<h3 id="plot-learnable-variables">Plot Learnable Variables</h3>
<p>Each learnable variable has a plot function (<a href="../api/models/#plot">API</a>) to plot the function itself and associated derivatives.</p>
<p>The following code plots only the original function <span class="arithmatex">\(y\)</span> in an individual matplotlib figure on the domain <span class="arithmatex">\([0, 1]\)</span>.
<div class="language-py highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="n">pde_model</span><span class="o">.</span><span class="n">agents</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span></code></pre></div></p>
<p>The following code plots <span class="arithmatex">\(y, y', y''\)</span> in one row three column:
<div class="language-py highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="n">pde_model</span><span class="o">.</span><span class="n">endog_vars</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]},</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a><span class="n">pde_model</span><span class="o">.</span><span class="n">endog_vars</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s2">&quot;y_x&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]},</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a><span class="n">pde_model</span><span class="o">.</span><span class="n">endog_vars</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s2">&quot;y_xx&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]},</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a><span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">()</span>
</span><span id="__span-27-6"><a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></code></pre></div></p>
<p>The following code plots <span class="arithmatex">\(u(x,y)\)</span> in 2D:
<div class="language-py highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;projection&quot;</span><span class="p">:</span> <span class="s2">&quot;3d&quot;</span><span class="p">})</span>
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="n">pde_model</span><span class="o">.</span><span class="n">endog_vars</span><span class="p">[</span><span class="s2">&quot;u&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s2">&quot;u&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.</span><span class="p">]},</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">()</span>
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></code></pre></div></p>
<h3 id="plot-variables-defined-by-equations">Plot Variables Defined by Equations</h3>
<p>PDEModel has a <code>plot_vars</code> function (<a href="../api/pde_model/#plot_vars">API</a>), which can plot any variables that are already defined in a <code>PDEModel</code> or additional variables of interests using new equations.</p>
<p>The following code will plot <span class="arithmatex">\(q_t^a, \sigma_t^{qa}, w_t^{ia}, w_t^{ha}\)</span> and risk premium (rp) in a four-column format. The risk premium is a new variable defined by <span class="arithmatex">\(r_t^{ka} - r_t\)</span>.
<div class="language-py highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="n">pde_model</span><span class="o">.</span><span class="n">plot_vars</span><span class="p">([</span>
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a>    <span class="sa">r</span><span class="s2">&quot;$q_t^a$&quot;</span><span class="p">,</span> 
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a>    <span class="sa">r</span><span class="s2">&quot;$\sigma_t^</span><span class="si">{qa}</span><span class="s2">$&quot;</span><span class="p">,</span> 
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a>    <span class="sa">r</span><span class="s2">&quot;$w_t^</span><span class="si">{ia}</span><span class="s2">$&quot;</span><span class="p">,</span> 
</span><span id="__span-29-5"><a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a>    <span class="sa">r</span><span class="s2">&quot;$w_t^</span><span class="si">{ha}</span><span class="s2">$&quot;</span><span class="p">,</span>
</span><span id="__span-29-6"><a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a>    <span class="sa">r</span><span class="s2">&quot;$rp = r_t^</span><span class="si">{ka}</span><span class="s2"> - r_t $&quot;</span><span class="p">])</span>
</span></code></pre></div></p>
<p>The following code will plot <span class="arithmatex">\(q_t^a, \sigma_t^{qa}, w_t^{ia}, w_t^{ha}\)</span> in a 2x2 grid.
<div class="language-py highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="n">pde_model</span><span class="o">.</span><span class="n">plot_vars</span><span class="p">([</span>
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a>    <span class="sa">r</span><span class="s2">&quot;$q_t^a$&quot;</span><span class="p">,</span> 
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a>    <span class="sa">r</span><span class="s2">&quot;$\sigma_t^</span><span class="si">{qa}</span><span class="s2">$&quot;</span><span class="p">,</span> 
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a>    <span class="sa">r</span><span class="s2">&quot;$w_t^</span><span class="si">{ia}</span><span class="s2">$&quot;</span><span class="p">,</span> 
</span><span id="__span-30-5"><a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a>    <span class="sa">r</span><span class="s2">&quot;$w_t^</span><span class="si">{ha}</span><span class="s2">$&quot;</span><span class="p">],</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span></code></pre></div></p>
<h3 id="plot-loss">Plot Loss</h3>
<p><code>plot_loss_df</code> (<a href="../api/utils/#plot_loss_df">API</a>) plots losses in the logged csv file.</p>
<p>A general usage to plot all losses in the file <code>./models/1d_prob/1d_prob_loss.csv</code>:
<div class="language-py highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="kn">from</span> <span class="nn">deep_macrofin</span> <span class="kn">import</span> <span class="n">plot_loss_df</span>
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a><span class="n">plot_loss_df</span><span class="p">(</span><span class="n">fn</span><span class="o">=</span><span class="s2">&quot;./models/1d_prob/1d_prob_loss.csv&quot;</span><span class="p">,</span> <span class="n">loss_plot_fn</span><span class="o">=</span><span class="s2">&quot;./models/1d_prob/1d_prob_loss.png&quot;</span><span class="p">)</span>
</span></code></pre></div></p>
<div class="footnote">
<hr />
<ol>
<li id="fn:1">
<p>Chenxi Wu, and Min Zhu, and Qinyang Tan, and Yadhu Kartha, and Lu Lu, <em>"A comprehensive study of non-adaptive and residual-based adaptive sampling for physics-informed neural networks"</em>, 2022-07-21, <a href="https://arxiv.org/abs/2207.10289" target="_blank">arXiv:2207.10289</a>&#160;<a class="footnote-backref" href="#fnref:1" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
<li id="fn:2">
<p>Rafael Bischof, and Michael Kraus, <em>"Multi-Objective Loss Balancing for Physics-Informed Deep Learning"</em>, 2021-10-19, <a href="https://arxiv.org/abs/2110.09813">arXiv:2110.09813</a>&#160;<a class="footnote-backref" href="#fnref:2" title="Jump back to footnote 2 in the text">&#8617;</a></p>
</li>
<li id="fn:3">
<p>A. Ali Heydari, and Craig A. Thompson, and Asif Mehmood, <em>"SoftAdapt: Techniques for Adaptive Loss Weighting of Neural Networks with Multi-Part Loss Functions"</em>, 2019-12-27, <a href="https://arxiv.org/abs/1912.12355">arXiv:1912.12355</a>&#160;<a class="footnote-backref" href="#fnref:3" title="Jump back to footnote 3 in the text">&#8617;</a></p>
</li>
<li id="fn:4">
<p>Yanjie Song, and He Wang, and He Yang, and Maria Luisa Taccari, and Xiaohui Chen, <em>"Loss-attentional physics-informed neural networks"</em>, Journal of Computational Physics, Volume 501, 2024, <a href="https://www.sciencedirect.com/science/article/pii/S0021999124000305">link</a>&#160;<a class="footnote-backref" href="#fnref:4" title="Jump back to footnote 4 in the text">&#8617;</a></p>
</li>
</ol>
</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Rotman Finhub
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant", "navigation.sections", "navigation.tabs", "navigation.top", "content.code.copy"], "search": "../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.83f73b43.min.js"></script>
      
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
      
        <script src="../assets/js/lightbox.js"></script>
      
        <script src="../assets/js/mathjax.js"></script>
      
        <script src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>